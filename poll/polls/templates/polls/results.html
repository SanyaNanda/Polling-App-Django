{% extends 'polls/base.html' %}
{% block title %}
Result
{% endblock %}
{% block content %}


<script src="https://cdn.zingchart.com/zingchart.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<h1>{{ question.question_text }}</h1>
<ul>
	{% for choice in question.choice_set.all %}
	<div class="card">
  	<div class="card-body">
	{{ choice.choice_text }}
	<span class="badge badge-primary float-right">{{ choice.votes }} vote{{ choice.votes | pluralize }}</span>
</div>
</div>

	{% endfor %}
</ul>
<div id="myChart"></div>

<script>
	var state={
		'items':[],
		'values':[],
	}

	var objId = "{{question.id}}"
	var dataurl = '/polls/resultdata/${objId}/'

	$.ajax({
		method:'GET',
		url:dataurl,
		success:function(response){
			for (var i in response){
				var key = Object.keys(response[i])[0]
				var value = Object.values(response[i])[0]

				state.items.push(key)
				state.values.push(value)
			}

			buildChart()
		}
	})

	function buildChart(){
		var chartData={
			"type":"bar",
			"scale-x":{
				"values":state.items
			},
			"series":[{
				"values":state.values
			}]
		}

		zingchart.render({
			id: "myChart",
			data: chartData,
		});
}

</script>
<a href="{% url 'polls:index' %}" class="btn btn-primary">Home</a>
{% endblock %}